YUI.add("moodle-atto_znaniumcombook-button",function(e,t){var o="atto_znaniumcombook",n='<a href="{{url}}"{{#if newwindow}} target="_blank"{{/if}}>{{description}}</a>',i='<form class="atto_form"><div class="mb-1"><label for="{{elementid}}_atto_znaniumcombook_page">{{get_string "page_modal_page" component}}</label><input class="form-control atto_znaniumcombook_page" type="text" id="{{elementid}}_atto_znaniumcombook_page"/></div><div class="form-check"><input type="checkbox" class="form-check-input atto_znaniumcombook_newwindow" id="{{elementid}}_atto_znaniumcombook_newwindow"/><label class="form-check-label" for="{{elementid}}_atto_znaniumcombook_newwindow">{{get_string "page_modal_new_window" component}}</label></div><div class="mdl-align"><br/><button type="submit" class="btn btn-secondary submit">{{get_string "page_modal_button" component}}</button></div></form>';e.namespace("M.atto_znaniumcombook").Button=e.Base.create("button",e.M.editor_atto.EditorPlugin,[],{_currentSelection:null,_bookId:null,_description:null,_cover:null,_page:null,_newWindow:!1,_pageDialogueContent:null,initializer:function(){this.addButton({title:"button_name",icon:"icon",iconComponent:"mod_znaniumcombook",callback:this._displaySearchDialogue,buttonName:"znaniumcombook"}),this.get("host").on("pluginsloaded",function(){this._updateButtonState(),this.get("host").on("atto:selectionchanged",this._updateButtonState,this)},this)},_updateButtonState:function(){this._anchorSelected()?this.disableButtons("znaniumcombook"):this.enableButtons("znaniumcombook")},_anchorSelected:function(){var t=this.get("host").getSelectionParentNode();if(t)return 0<this._findSelectedAnchors(e.one(t)).length},_findSelectedAnchors:function(t){var e,o,n=t.get("tagName");return n&&"a"===n.toLowerCase()?[t]:(o=[],t.all("a").each(function(t){!e&&this.get("host").selectionContainsNode(t)&&o.push(t)},this),0<o.length?o:(e=t.ancestor("a"))?[e]:[])},_displaySearchDialogue:function(){var e,o;this._currentSelection=this.get("host").getSelection(),!1!==this._currentSelection&&(e="atto_znaniumcombook/bookpicker-lazy",o=this,M.util.js_pending(e),require([e],function(t){M.util.js_complete(e),t.init(o._onBookSelected.bind(o))}))},_onBookSelected:function(t,e,o){this._bookId=t,this._description=e,this._cover=o,this._displayPageDialogue()},_displayPageDialogue:function(){var t=this.getDialogue({headerContent:M.util.get_string("page_modal_title",o),width:"auto",focusAfterHide:!0,focusOnShowSelector:".atto_znaniumcombook_page"});t.set("bodyContent",this._getPageDialogueContent()),t.show()},_getPageDialogueContent:function(){var t=e.Handlebars.compile(i);return this._pageDialogueContent=e.Node.create(t({component:o})),this._pageDialogueContent.one(".submit").on("click",this._onPageEntered,this),this._pageDialogueContent},_onPageEntered:function(t){var e;t.preventDefault(),this.getDialogue({focusAfterHide:null}).hide(),e=this._pageDialogueContent.one(".atto_znaniumcombook_page").get("value").trim(),new RegExp(/^[0-9]+$/).test(e)?this._page=e:this._page=null,this._newWindow=!!this._pageDialogueContent.one(".atto_znaniumcombook_newwindow").get("checked"),this._insertHyperlink()},_insertHyperlink:function(){var t,e=this.get("host");e.setSelection(this._currentSelection),t=this._getHtml(),e.insertContentAtFocusPoint(t),this.markUpdated()},_getHtml:function(){var t=M.cfg.wwwroot+"/blocks/znanium_com/redirect.php?documentid="+this._bookId;return this._page&&(t=t+"&page="+this._page),e.Handlebars.compile(n)({url:t,description:this._description,cover:this._cover,newwindow:this._newWindow})}})},"@VERSION@",{requires:["moodle-editor_atto-plugin"]});